# Техническое задание: Система управления задачами (поездками) для транспортной логистики

**Версия:** 1.2  
**Дата:** 14.02.2026

---

## 1. Общее описание

Разрабатывается система для автоматизации процессов создания, назначения и контроля выполнения задач, связанных с поездками. Система реализуется в виде **Telegram Web App** (мини-приложение внутри Telegram) с использованием Telegram Bot API для авторизации и уведомлений. Архитектура разделена на высокопроизводительное ядро на **C++** (реализация сложных алгоритмов подбора исполнителей) и основную бизнес-логику на **Python**. Система предназначена для трёх ролей: **менеджер**, **диспетчер** (он же отвечает за техническое состояние автопарка) и **наблюдатель** (viewer).

## 2. Цели проекта

- Сокращение времени на согласование и назначение транспорта за счёт интеллектуальных алгоритмов подбора водителя и машины (C++ ядро).
- Централизованное хранение заявок и документов.
- Прозрачный контроль статусов задач с уведомлениями через Telegram.
- Учёт нештатных ситуаций (поломки, болезни) через журнальные записи, влияющие на доступность ресурсов.
- Возможность наблюдения за процессом для сторонних лиц без права вмешательства.

## 3. Архитектура и технологии

- **Клиентская часть:** Telegram Web App (HTML, CSS, JavaScript), интегрированный с Telegram Bot API. Авторизация пользователей через Telegram ID.
- **Серверная часть (Python):** Основной бэкенд на Python (FastAPI/Django) для обработки запросов от клиента, управления пользователями, задачами, журнальными записями, уведомлениями и взаимодействия с базой данных.
- **Ядро (C++):** Отдельный модуль, отвечающий за:
  - Управление очередями задач.
  - Реализацию алгоритмов оптимизации для подбора наиболее подходящего водителя и машины (с учётом времени в пути, загруженности, текущих статусов).
  - Сложные вычисления, требующие максимальной скорости.
- **Взаимодействие Python и C++:** через REST API, gRPC или прямой вызов (будет определено на этапе проектирования).
- **База данных:** (будет выбрана позже, рекомендуется PostgreSQL).
- **Хранение файлов:** локально или в объектном хранилище (MinIO), с поддержкой просмотра PDF.
- **Инфраструктура:** контейнеризация через Docker, развёртывание в облаке.

## 4. Роли пользователей и их права

| Роль         | Описание                                                                 | Основные функции                                                                                          |
|--------------|--------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------|
| Менеджер     | Инициирует задачи, контролирует выполнение, подтверждает завершение     | Создание задач, прикрепление файлов, поиск/фильтрация, изменение статусов, просмотр истории, отмена задач |
| Диспетчер    | Назначает исполнителей, ведёт учёт нештатных ситуаций                   | Просмотр очереди новых задач, получение уведомлений, запуск алгоритма подбора водителя/ТС, изменение статусов, создание/закрытие журнальных записей (болезни/поломки) |
| Наблюдатель  | Только просматривает процесс без возможности изменений                  | Просмотр списка задач, их деталей, истории, журнальных записей (read-only)                                 |

*Примечание: функции механика (контроль технического состояния) выполняет диспетчер через создание журнальных записей о поломках; отдельной роли механика нет.*

## 5. Функциональные требования

### 5.1. Модуль аутентификации и интеграция с Telegram

- При запуске Web App пользователь авторизуется через Telegram ().
- Роль пользователя определяется по его Telegram ID (предварительно настроено администратором).
- Все уведомления о смене статусов задач приходят в Telegram-бота (личные сообщения).

### 5.2. Модуль задач

#### 5.2.1. Создание задачи (менеджер)

- Форма создания задачи содержит поля:
  - Название/номер заявки (обязательное)
  - Текстовое описание (опционально)
  - Прикрепление файла (PDF, изображения, документы) – обязательный просмотр в интерфейсе
  - Дата и время требуемого выполнения (опционально)
- После создания задача получает статус **«В ожидании»**.
- Уведомление о новой задаче отправляется диспетчеру (в Telegram).

#### 5.2.2. Список задач и фильтрация (все роли, но наблюдатель только просмотр)

- Отображение задач в виде списка/карточек с возможностью сортировки по дате, статусу, номеру.
- Фильтры:
  - По статусу («В ожидании», «В работе», «Ожидает подтверждения», «Завершена», «Отменена»)
  - По дате (период)
  - По тексту (поиск по номеру, описанию)
  - По водителю/машине (если назначено)

#### 5.2.3. Жизненный цикл задачи и статусы

- **В ожидании** – задача создана, ожидает назначения.
- **В работе** – задача назначена и выполняется.
- **Ожидает подтверждения** – выполнена, ждёт подтверждения менеджера.
- **Завершена** – подтверждена менеджером.
- **Отменена** – может быть отменена менеджером или диспетчером на любом этапе (с обязательным комментарием причины).

**Переходы:**
1. Менеджер создаёт задачу → «В ожидании».
2. Диспетчер назначает исполнителей (через алгоритм C++ ядра) → «В работе».
3. После выполнения диспетчер переводит в «Ожидает подтверждения».
4. Менеджер подтверждает → «Завершена».
5. Любой пользователь с правом отмены (менеджер, диспетчер) может перевести задачу в «Отменена» (с комментарием).

При каждом изменении статуса:
- Уведомление в Telegram заинтересованным лицам (менеджеру и/или диспетчеру).
- Фиксация в истории задачи (пользователь, дата, старый/новый статус, комментарий).

#### 5.2.4. Назначение водителя и машины (диспетчер с использованием C++ ядра)

- В интерфейсе задачи диспетчер нажимает кнопку «Подобрать исполнителя».
- Запрос уходит в C++ модуль, который на основе текущих данных (свободные водители, исправные машины, их местоположение, загруженность, журнальные записи о болезнях/поломках) возвращает оптимальную пару (водитель + ТС) с наименьшим предполагаемым временем подачи/выполнения.
- Диспетчер может подтвердить предложенный вариант или выбрать вручную из списка доступных (с учётом ограничений).
- После подтверждения задача переходит в «В работе».

#### 5.2.5. Добавление информации о поездке (менеджер)

- Менеджер может в любой момент добавить текстовую заметку «Информация о поездке» (например, особые обстоятельства). Поле сохраняется в задаче и отображается в истории.

#### 5.2.6. Просмотр завершённых задач (все роли, но наблюдатель только просмотр)

- Доступен архив задач со статусом «Завершена» или «Отменена».
- В детальной карточке отображается:
  - Вся введённая информация (описание, файлы)
  - Назначенные водитель и машина
  - Хронология статусов с датами и комментариями
  - Информация о поездке
  - Журнальные записи, актуальные на момент выполнения

### 5.3. Модуль диспетчера (журнальные записи)

#### 5.3.1. Учёт журнальной работы

- Диспетчер может создавать записи о нештатных ситуациях:
  - **Болезнь водителя** (выбор водителя, дата начала, опционально дата окончания).
  - **Поломка машины** (выбор ТС, описание поломки, предполагаемая дата восстановления).
- Эти записи автоматически влияют на доступность водителей/машин в интерфейсе назначения (они не предлагаются алгоритмом и помечаются как недоступные).
- Записи могут быть закрыты (дата окончания) вручную диспетчером.

#### 5.3.2. Просмотр состояния автопарка (диспетчер и наблюдатель)

- Отдельный раздел со списком автомобилей и их статусами (исправен, в ремонте, на выезде) на основе журнальных записей.
- Возможность фильтрации по статусу.

### 5.4. Модуль наблюдателя (viewer)

- Наблюдатель имеет доступ только к чтению:
  - Просмотр списка задач (с фильтрацией и поиском).
  - Просмотр детальной информации по задаче, включая историю, файлы, журнальные записи.
  - Просмотр состояния автопарка и журнальных записей.
- Наблюдатель не может создавать, изменять или удалять задачи и записи.
- Наблюдатель не получает уведомлений (опционально можно настроить, но по умолчанию нет).

### 5.5. Уведомления (Telegram)

- Уведомления отправляются через Telegram Bot:
  - Новая задача создана (диспетчеру).
  - Задача назначена / статус изменён на «В работе» (менеджеру).
  - Задача ожидает подтверждения (менеджеру).
  - Задача завершена (диспетчеру).
  - Задача отменена (менеджеру и диспетчеру).
- Текст уведомления содержит номер задачи, текущий статус и краткую информацию.

### 5.6. Функции общего доступа

- Поиск задач по номеру/тексту.
- Просмотр прикреплённых PDF-файлов (встроенный просмотрщик).
- История изменений задачи (лог действий) – доступна всем, но наблюдатель только читает.

## 6. Нефункциональные требования

- **Производительность:** Время ответа C++ ядра при подборе кандидата – не более 500 мс. Загрузка списка задач – до 2 секунд при 1000 задачах.
- **Безопасность:**
  - Все данные шифруются при передаче (HTTPS).
  - Чувствительные данные в базе шифруются (например, личные данные водителей).
  - Защита от CSRF, XSS.
  - Доступ только авторизованных пользователей через Telegram.
- **Надёжность:** Регулярное резервное копирование базы данных и файлов.
- **Логирование:** Все действия пользователей (создание, изменение статусов, отмена, добавление записей) логируются с указанием времени, пользователя и изменённых полей. Логи доступны администратору.
- **Масштабируемость:** Возможность горизонтального масштабирования Python-части и C++ ядра.

## 7. Пользовательские сценарии (примеры)

### Сценарий 1: Полный цикл задачи

1. Менеджер через Telegram Web App создаёт задачу, прикрепляет PDF-заявку. Статус «В ожидании».
2. Диспетчер получает уведомление, открывает задачу, нажимает «Подобрать исполнителя». C++ ядро возвращает оптимальную пару (водитель Иванов, машина А123). Диспетчер подтверждает.
3. Статус задачи меняется на «В работе», менеджер получает уведомление.
4. После выполнения диспетчер переводит задачу в «Ожидает подтверждения».
5. Менеджер получает уведомление, добавляет информацию о поездке и подтверждает завершение. Статус «Завершена».
6. Диспетчер и наблюдатель (если есть) видят финальный статус.

### Сценарий 2: Учёт поломки

1. Диспетчер фиксирует поломку машины Б456: создаёт журнальную запись с описанием.
2. При следующем подборе исполнителей C++ ядро не предлагает эту машину.
3. После ремонта диспетчер закрывает запись, машина снова доступна.

### Сценарий 3: Наблюдение

1. Наблюдатель заходит в приложение, видит список всех задач, может открыть любую и посмотреть детали, но кнопки создания/изменения отсутствуют.

## 8. Интерфейс пользователя

- Интерфейс реализован как Telegram Web App, адаптированный под мобильные устройства и десктоп.
- Основные элементы:
  - Список задач с фильтрацией и поиском.
  - Детальная карточка задачи с вкладками: информация, история, файлы.
  - Панель диспетчера с кнопкой запуска алгоритма подбора и разделом журнальных записей.
  - Раздел состояния автопарка (для диспетчера и наблюдателя).
  - Профиль пользователя с отображением роли.
- Для наблюдателя все интерактивные элементы (кнопки создания, изменения) скрыты или заблокированы.

## 9. Требования к данным (предварительно)

- **Пользователи:** Telegram ID, ФИО, роль, контакты (опционально).
- **Водители:** ФИО, статус (активен/болен/в отпуске), возможно, координаты или зона работы.
- **Автомобили:** модель, госномер, статус (исправен/в ремонте).
- **Задачи:** номер, описание, файлы (ссылки), статус, даты создания/изменения, назначенные водитель/машина, комментарии.
- **История изменений:** дата, пользователь, поле, старое значение, новое значение.
- **Журнальные записи:** тип (болезнь/поломка), объект (водитель/машина), описание, дата начала, дата окончания.

## 10. Ограничения и допущения

- В первой версии не планируется полноценная картография (используется только для оценки времени через C++ алгоритм, но без отображения карт в интерфейсе). Возможно, будет использован генератор ссылок на Яндекс.Карты для отображения маршрута (опционально).
- Интеграция с Битрикс24 отложена на будущее.
- Способ взаимодействия Python и C++ будет определён на этапе технического проектирования.

## 11. Этапы реализации

1. Проектирование архитектуры, выбор стека, уточнение протокола взаимодействия Python и C++.
2. Разработка базового каркаса: авторизация через Telegram, роли, создание задач.
3. Реализация C++ ядра (очереди, алгоритмы подбора) и интеграция с Python.
4. Разработка модуля диспетчера и журнальных записей.
5. Реализация роли наблюдателя (read-only доступ).
6. Реализация уведомлений в Telegram.
7. Тестирование (включая нагрузочное для C++ ядра).
8. Документирование и развёртывание.

---
